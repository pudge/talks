<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
        "http://www.w3.org/TR/2000/REC-xhtml1-20000126/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
	<title>Code: poll_10</title>
	<link rel="Stylesheet" href="./styles.css" type="text/css" />
</head>
<body class="codepage">
<blockquote><p class="codepage"><tt>
sub pollbooth {<br />&nbsp; &nbsp; my($qid, $notable) = @_;<br /><br />&nbsp; &nbsp; ($qid) = getvar("currentqid") unless $qid;<br />&nbsp; &nbsp; my $qid_dbi = $I{dbh}-&gt;quote($qid);<br />&nbsp; &nbsp; my $qid_htm = stripByMode($qid, 'attribute');<br /><br />&nbsp; &nbsp; my $cursor = $I{dbh}-&gt;prepare_cached("<br />&nbsp; &nbsp; &nbsp; &nbsp; SELECT question,answer,aid&nbsp; from pollquestions, pollanswers<br />&nbsp; &nbsp; &nbsp; &nbsp; WHERE pollquestions.qid=pollanswers.qid AND<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; pollquestions.qid=$qid_dbi<br />&nbsp; &nbsp; &nbsp; &nbsp; ORDER BY pollanswers.aid<br />&nbsp; &nbsp; ");<br />&nbsp; &nbsp; $cursor-&gt;execute;<br /><br />&nbsp; &nbsp; my($x, $tablestuff) = (0);<br />&nbsp; &nbsp; while (my($question, $answer, $aid) = $cursor-&gt;fetchrow) {<br />&nbsp; &nbsp; &nbsp; &nbsp; if ($x == 0) {<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $tablestuff = &lt;&lt;EOT;<br />&lt;FORM ACTION="$I{rootdir}/pollBooth.pl"&gt;<br />\t&lt;INPUT TYPE="hidden" NAME="qid" VALUE="$qid_htm"&gt;<br />&lt;B&gt;$question&lt;/B&gt;<br />EOT<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $tablestuff .= &lt;&lt;EOT if $I{currentSection};<br />\t&lt;INPUT TYPE="hidden" NAME="section" VALUE="$I{currentSection}"&gt;<br />EOT<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $x++;<br />&nbsp; &nbsp; &nbsp; &nbsp; }<br />&nbsp; &nbsp; &nbsp; &nbsp; $tablestuff .= qq!&lt;BR&gt;&lt;INPUT TYPE="radio" NAME="aid" VALUE="$aid"&gt;$answer\n!;<br />&nbsp; &nbsp; }<br /><br />&nbsp; &nbsp; my($voters) = sqlSelect('voters', 'pollquestions', " qid=$qid_dbi");<br />&nbsp; &nbsp; my($comments) = sqlSelect('count(*)', 'comments', " sid=$qid_dbi");<br />&nbsp; &nbsp; my $sect = "section=$I{currentSection}&amp;" if $I{currentSection};<br /><br />&nbsp; &nbsp; $tablestuff .= qq!&lt;BR&gt;&lt;INPUT TYPE="submit" VALUE="Vote"&gt; ! .<br />&nbsp; &nbsp; &nbsp; &nbsp; qq![ &lt;A HREF="$I{rootdir}/pollBooth.pl?${sect}qid=$qid_htm&amp;aid=-1"&gt;&lt;B&gt;Results&lt;/B&gt;&lt;/A&gt; | !;<br />&nbsp; &nbsp; $tablestuff .= qq!&lt;A HREF="$I{rootdir}/pollBooth.pl?$sect"&gt;&lt;B&gt;Polls&lt;/B&gt;&lt;/A&gt; !<br />&nbsp; &nbsp; &nbsp; &nbsp; unless $notable eq 'rh';<br />&nbsp; &nbsp; $tablestuff .= "Votes:&lt;B&gt;$voters&lt;/B&gt;" if $notable eq 'rh';<br />&nbsp; &nbsp; $tablestuff .= " ] &lt;BR&gt;\n";<br />&nbsp; &nbsp; $tablestuff .= "Comments:&lt;B&gt;$comments&lt;/B&gt; | Votes:&lt;B&gt;$voters&lt;/B&gt;\n" if $notable ne 'rh';<br />&nbsp; &nbsp; $tablestuff .="&lt;/FORM&gt;\n";<br />&nbsp; &nbsp; $cursor-&gt;finish;<br /><br />&nbsp; &nbsp; return $tablestuff if $notable;<br />&nbsp; &nbsp; fancybox($I{fancyboxwidth}, 'Poll', $tablestuff, 'c');<br />}<br />
</tt></p></blockquote>
</body>
</html>
